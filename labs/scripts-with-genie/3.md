## Step 3. Execute Genie script with Easypy


0. Run Docker container and activate your Python virtual environment inside it

```
# Run Docker container
docker run -it -v ~/genie_learning_lab:/genie_tests ciscotestautomation/pyats:latest-robot /bin/bash

# Once inside the Docker container, activate Python virtual environment
cd /pyats
source bin/activate
```

Please note: This step is optional if you still have the Docker container launched in the `intro-to-genie` lab Step #4.


1. Navigate to the /genie_tests folder and view the script `genie_sample_job.py`

```
cd /genie_tests
cat genie_sample_job.py
```


2. Examine the contents of the script `genie_sample_job.py`

```python
'''
Sample Genie Job File
'''

# Author
__author__ = 'Cisco Systems Inc.'
__copyright__ = 'Copyright (c) 2018, Cisco Systems Inc.'
__contact__ = ['asg-genie-support@cisco.com']
__date__= 'June 2018'


# ATS & Genie
from ats.datastructures.logic import And, Not, Or
from genie.harness.main import gRun


def main(runtime):

    gRun(mapping_datafile='/genie_tests/mapping_datafile.yaml',
         trigger_uids=And('TriggerClearBgpNeighbor'),
         verification_uids=And('Verify_BgpAllNeighbors'),
         )

```

Review the Genie job file above and note the following components of the script:

- `gRun`

A pyATS script is derived from the information provided to the Genie Harness with gRun. The mapping file is the only mandatory argument provided to Genie.

Executing gRun launches Genie Harness to execute the pre-defined subsections in sequence: namely the common_setup, Verifications, Triggers, common_cleanup. Each subsection performs unique tasks such as connecting to devices, applying configuration, executing triggers and verifications etc. Users can control which subsections to run using the `subsection_datafile` argument.

For more information refer to the [Genie Harness Guide](https://pubhub.devnetcloud.com/media/pyats-packages/docs/genie/harness/user/gettingstarted.html)

- `mapping_datafile`

The PyATS testbed YAML file contains the testbed topology and ALL of the testbedâ€™s devices. Any given device in the testbed topology can be configured to support various connection protocols such as: Console, Network Mangement VTY, NETCONF(YANG), and more in the future. These communication protocol names are not standardized, hence Genie cannot know which one to use for which context.

The mapping_datafile allows for this mapping to happen seamlessly. The mapping_datafile argument is a YAML file that is used by Genie Harness to identify which devices from the testbed YAML the script should connect to, as well as which communication protocol to use when connecting to those devices.

- `trigger_uids`

By default, all Triggers in `genie.libs.sdk` are available for execution using Genie Harness. The trigger_uids argument is used to specify which Triggers we would like to execute using Genie Harness.

- `verification_uids`

By default, all Verification developed in `genie.libs.sdk` are available for execution using Genie Harness. The verification_uids argument is used to specify which Verifications we would like to execute using Genie Harness before and after each Trigger.

List of arguments supported by Genie Harness [gRun arguments](https://pubhub.devnetcloud.com/media/pyats-packages/docs/genie/harness/user/reference.html)


3. Examine the contents of the `mapping_datafile.yaml` located under /genie_tests

```yaml

devices:

  nx-osv-1:	<--- your device name
    context: cli
    label: uut
    mapping:
      cli: console
```

In the above example, we are mapping the console connection to be used for CLI. The device name can either be the hostname of the device defined in the testbed file, or the device alias. Note that aliases must be unique for for each device.


4. Execute the script using Easypy and view output of test execution on your terminal.

```
(pyats)$ easypy genie_sample_job.py -testbed_file /genie_tests/default_testbed.yaml -html_logs
```


## More Genie Examples

Genie comes with nine examples where each example demonstrates the flow of Genie and how it can be used in testing different features and frameworks. Navigate to the examples folder to peruse the sample scripts available to run:

```
(pyats)$ cd $VIRTUAL_ENV/examples/genie
(pyats)$ ls -l
total 36
-rw-r--r-- 1 staff eng    0 Jun  1 11:59 __init__.py
drwxr-xr-x 2 staff eng 4096 Jun  5 13:45 demo1_harness_simple
drwxr-xr-x 2 staff eng 4096 Jun  5 13:45 demo2_harness_triggers
drwxr-xr-x 2 staff eng 4096 Jun  5 13:45 demo3_harness_telemetry
drwxr-xr-x 2 staff eng 4096 Jun  5 13:45 demo4_harness_custom_trigger
drwxr-xr-x 2 staff eng 4096 Jun  5 13:45 demo5_robot
drwxr-xr-x 2 staff eng 4096 Jun  5 13:45 demo6_config_ops
drwxr-xr-x 3 staff eng 4096 Jun  5 13:45 demo7_trigger_within_pyats
drwxr-xr-x 3 staff eng 4096 Jun  5 13:45 demo8_pyats_conf_ops
drwxr-xr-x 3 staff eng 4096 Jun  5 13:45 demo9_context_comparator
```

Follow through the steps on the [Genie Examples](https://pubhub.devnetcloud.com/media/pyats-packages/docs/genie/examples/example.html) documentation to execute each of the above tests.

> Note: The examples above can be executed on the same VIRL device that was launched in the "boot-genie-virl" lab.


#### Congratulations! You've Completed Scripts with Genie!
