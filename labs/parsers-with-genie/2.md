## Step 2. Execute Genie Parsers


0. Run Docker container and activate your Python virtual environment inside it

```
# Run Docker container
docker run -it -v ~/genie_learning_lab:/genie_tests ciscotestautomation/pyats:latest-robot /bin/bash

# Once inside the Docker container, activate Python virtual environment
cd /pyats
source bin/activate
```

Please note: This step is optional if you still have the Docker container launched in the `intro-to-genie` lab Step #4.


1. Navigate to the /genie_tests folder and view the script `genie_parsers.robot`

```
cd /genie_tests
cat genie_parsers.robot
```


2. Examine the contents of the script `genie_parsers.robot`

```
# Genie Devnet Lab-2: Execute show commands and parse outputs
# ===========================================================


*** Settings ***
Library        ats.robot.pyATSRobot
Library        genie.libs.robot.GenieRobot
Library        unicon.robot.UniconRobot


*** Variables ***
# Defining variables that can be used elsewhere in the test data.
${testbed}     /genie_tests/default_testbed.yaml


*** TestCases ***
# Creating testcases using available Genie, PyATS & Unicon keywords


# Connect to UUT device using CLI
connect to UUT device
    use genie testbed "${testbed}"
    connect to devices "uut"


# Load parser "ShowBgpProcessVrfAll"
# Execute 'show bgp process vrf all'
# Parse the output of the show command using the parser loaded above
execute and parse 'show bgp process vrf all' on UUT
    parse "genie.libs.parser.show_bgp.ShowBgpProcessVrfAll" on device "uut"


# Load parser "ShowModule"
# Execute 'show module'
# Parse the output of the show command using the parser loaded above
execute and parse 'show platform' on UUT
    parse "genie.libs.parser.show_platform.ShowModule" on device "uut"
```

This is a sample script to execute show commands on a device and parse the output into script-readable Python datastructures using Genie.

Note that we don't specify the device type or operating system when executing the Genie parser. This is because the package `genie.abstract` uses abstraction based on the device operating system to dynamically "lookup" which OS libraries it would need to load for the parser (ex: Cisco NX or Cisco XE).

For more information on Abstract and Lookup, in Genie refer to the documentation below:
- [Genie Abstract](https://pubhub.devnetcloud.com/media/pyats-packages/docs/abstract/introduction.html)
- [Genie Lookup](https://pubhub.devnetcloud.com/media/pyats-packages/docs/abstract/lookup_class.html)

For a list of parsers available within the `genie.libs.parser` package package that can be executed in the manner shown above:
- [Genie Libs Parsers Availability](https://github.com/CiscoTestAutomation/genieparser)

3. Run this script by executing the following command and examine the output to see testcase results, HTML log report and XML output.

```
(pyats) root@cd999d662bb6:/genie_tests# robot genie_parsers.robot
==============================================================================
Genie Parsers
==============================================================================
connect to UUT device                                                 | PASS |
------------------------------------------------------------------------------
execute and parse 'show bgp process vrf all' on UUT                   | PASS |
------------------------------------------------------------------------------
execute and parse 'show platform' on UUT                              | PASS |
------------------------------------------------------------------------------
Genie Parsers                                                         | PASS |
3 critical tests, 3 passed, 0 failed
3 tests total, 3 passed, 0 failed
==============================================================================
Output:  /genie_tests/output.xml
Log:     /genie_tests/log.html
Report:  /genie_tests/report.html
```

View the log and report files created above as mentioned in the 'intro-to-genie' lab.


4. Let's take a look at how we can determine the Python parser for a parser

Let's clone the Genie Libs parsers repo and walk through the directory structure to determine how the directory structure/filenames/class names would map to the Genie parser library import as seen in the script above.

```
(pyats) root@cd999d662bb6:/pyats# cd $VIRTUAL_ENV/
(pyats) root@cd999d662bb6:/pyats# mkdir pypi ; cd pypi
(pyats) root@cd999d662bb6:/pyats/pypi# git clone https://github.com/CiscoTestAutomation/genieparser.git
Cloning into 'genieparser'...
remote: Counting objects: 281, done.
remote: Compressing objects: 100% (168/168), done.
remote: Total 281 (delta 122), reused 259 (delta 100), pack-reused 0
Receiving objects: 100% (281/281), 953.79 KiB | 0 bytes/s, done.
Resolving deltas: 100% (122/122), done.
Checking connectivity... done.
(pyats) root@cd999d662bb6:/pyats/pypi# cd genieparser/src/genie/libs/parser
(pyats) root@cd999d662bb6:/pyats/pypi/genieparser/src/genie/libs/parser# ls -l
total 20
-rw-r--r--. 1 root root  920 Jun  7 19:17 __init__.py
-rw-r--r--. 1 root root 2167 Jun  7 19:17 base.py
drwxr-xr-x. 3 root root 4096 Jun  7 19:17 iosxe
drwxr-xr-x. 3 root root 4096 Jun  7 19:17 iosxr
drwxr-xr-x. 3 root root 4096 Jun  7 19:17 nxos
drwxr-xr-x. 2 root root   42 Jun  7 19:17 template
drwxr-xr-x. 2 root root   40 Jun  7 19:17 utils
drwxr-xr-x. 3 root root   65 Jun  7 19:17 yang
```

As seen above, we followed through folder path "genie/libs/parser" under the genieparser/src folder. This in turn corresponds to the first part of our parser's Python library import `genie.libs.parser`. The Genie infra already knows which operating system we need (in this example: Cisco NX).

Let's check what files are available under the NXOS directory:

```
(pyats) root@cd999d662bb6:/pyats/pypi/genieparser/src/genie/libs/parser# ls -l
total 1444
-rw-r--r-- 1 staff eng     61 May  2 12:15 __init__.py
-rw-r--r-- 1 staff eng   1485 May  2 12:15 show_arp.py
-rwxr-xr-x 1 staff eng 482763 May 28 04:33 show_bgp.py          <<<<< Python file containing parser class ShowBgpProcessVrfAll
-rw-r--r-- 1 staff eng   2327 May  2 12:15 show_feature.py
-rw-r--r-- 1 staff eng  39713 May  2 12:15 show_hsrp.py
-rwxr-xr-x 1 staff eng 120072 May  2 12:15 show_interface.py
-rw-r--r-- 1 staff eng  38476 May  2 12:15 show_mcast.py
-rwxr-xr-x 1 staff eng 169143 May  2 12:15 show_ospf.py
-rw-r--r-- 1 staff eng  56775 May 23 14:20 show_platform.py     <<<<< Python file containing parser class ShowModule
```

Examine the Python files `show_bgp.py` and `show_platform.py`. You you will see that these files contain the Python parser classes called ShowBgpProcessVrfAll and ShowPlatform respectively. These parser classes can be used to parse the show command output and return a Python datastructure containing the parsed information.

As seen above, we can conclude that our Python library imports for the show commands would be `genie.libs.parser.show_bgp.ShowBgpProcessVrfAll` and `genie.libs.parser.show_platform.ShowModule` respectively.


#### Congratulations! You've Completed Parsers with Genie!
