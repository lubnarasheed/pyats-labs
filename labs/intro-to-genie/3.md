## Step 3. Define your Genie Testbed

Before we get started, we must tell Genie which devices we are running our tests against. This is called a `testbed` file.

For more infromation on PyATS & Genie testbeds, you can refer to the [Topology Documentation](https://pubhub.devnetcloud.com/media/pyats/docs/topology/introduction.html)


1. Generate a testbed file for your simulation

```
virl generate pyats
```


2. Examine the testbed file

```
cat default_testbed.yaml
```

The testbed file is a [YAML](https://en.wikipedia.org/wiki/YAML) (“Yet Another Markup Language”); it is a data serialization format that is designed to be both human-readable and machine-readable. YAML is indentation & white space sensitive. Its syntax maps directly to most common datastructures in Python, such dict, list, str etc.

Your testbed file contains definitions of various things in the environment such as routers, switches, links, external servers, or traffic generators.

As a example to illustrate the above, the NX-OSv router defintion for the newly launched testbed would look like this:

```
devices:
  nx-osv-1: <--- hostname
    alias: nx-osv-1
    type: NX-OSv
    connections:

      defaults:
        class: unicon.Unicon
      console:
        protocol: telnet
        port: 17040
        ip: 172.25.192.90
```

A more comprehensive testbed sample can be found
  <a href="https://pubhub.devnetcloud.com/media/pyats/docs/topology/schema.html#production-yaml-schema" target="_blank">
    here
  </a>
you should take a few minutes to review some of the additional options that can be configured for a given testbed.


3. The testbed YAML file that was generated above will need a few more edits before it can be used for Genie. Open up the testbed YAML file using any editor and make the changes outlined below:

For the "testbed" section:

  * Remove the `servers` block

For device "nx-osv-1":

  * Set the `alias` key to be "uut"
  * Add key `os` and set its value to be "nxos"
  * Add `passwords` section as shown below
  * Add `custom` section as shown below

```
devices:
  nx-osv-1:
    alias: 'uut'     <--- (changed from 'nx-osv-1')
    os: 'nxos'       <--- (set to 'nxos')
    type: NX-OSv
    passwords:       <--- (telnet passwords)
      tacacs: admin
      enable: admin
      line: admin
    custom:
      execute_timeout: 300
      configure_timeout: 250
      abstraction:
        order: [os, type]
        os: 'nxos'
        type: 'nxosv'
```

For device "csr1000v-1":

  * Set the `alias` key to be "helper"
  * Add key `os` and set its value to be "iosxe"
  * Add `passwords` section as shown below
  * Add `custom` section as shown below

```
devices:
  csr1000v-1:
    alias: 'helper'  <--- (changed from 'csr1000v-1')
    os: 'iosxe'      <--- (set to 'iosxe')
    type: CSR1000v
    passwords:       <--- (telnet passwords)
      tacacs: cisco
      enable: cisco
      line: cisco
    custom:
      execute_timeout: 300
      configure_timeout: 250
      abstraction:
        order: [os, type]
        os: 'iosxe'
        type: 'csr1000'
```


More information on the keys changed in the testbed YAML:

1. `alias`: Genie will use the `alias` to refer to devices in the testbed during test execution.

2. `os`: Genie will read the `os` key to determine the type of operating system that is running on this device

3. `passwords`: If the device has passwords configured, Unicon will need know what to pass through to the device on a password prompt, these values get set here

4. `custom`: In this section we define anything extra needed for Unicon (such as execute and configure timeouts) and `abstraction` needed for Genie to correctly load OS specific libraries.

**NOTE: 
- Find the console IP address for each device within your testbed YAML file. 
- Telnet to both devices in the testbed to ensure they are up and running before proceeding to the next steps.***


#### Next Step: Install Genie Packages
